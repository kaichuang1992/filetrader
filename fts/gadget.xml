<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="FT"
               author="FranÃ§ois Kooman"
               author_email="fkooman@tuxed.net">
    <Require feature="opensocial-0.9"/>
    <Require feature="osapi"/>
  </ModulePrefs>
  <UserPref name="groupContext"/>	<!-- for SURFconext -->
  <Content type="html">
<![CDATA[
<script type="text/javascript">

    <!-- for SURFconext -->
    var prefs = new gadgets.Prefs();
    var groupContext = escape(prefs.getString('groupContext'));
    <!-- /for SURFconext -->

    /* Should get this from gadget data... */
    var apiEndPoint = "https://frkosp.wind.surfnet.nl/fts/index.php";

    /* SURFconext */
    function getMyGroups() {
        osapi.groups.get({userId: '@owner'}).execute(function(response) {
            var output = '';
            for(var f in response.list) {
                output += response.list[f].title + " (" + response.list[f].description + ")\n";
            }
            alert(output);
        });
    };

    /* iGoogle */
    function getMyFriends() {
        osapi.people.get({userId: '@owner', groupId: '@friends'}).execute(function(response) {
	    var output = '';
            for(var f in response.list) {
		output += JSON.stringify(response.list[f]) + "\n";
            }
            alert(output);
        });
    };

    function pingServer() {
        var params = {};
        var url = apiEndPoint + "?action=pingServer";
        gadgets.io.makeRequest(url, function(response) { 
            alert(response.text);
        }, params);
    };

    function serverInfo() {
        var params = {};
        params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.JSON;
        params[gadgets.io.RequestParameters.AUTHORIZATION] = gadgets.io.AuthorizationType.SIGNED;
        var url = apiEndPoint + "?action=serverInfo";
        gadgets.io.makeRequest(url, function(response) { 
            alert(response.text);
        }, params);
    };

    function getDirList(relativePath) {
        var params = {};
        params[gadgets.io.RequestParameters.AUTHORIZATION] = gadgets.io.AuthorizationType.SIGNED;
        params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.JSON;
        var url = apiEndPoint + "?action=getDirList&relativePath=" + relativePath;
        gadgets.io.makeRequest(url, function(response) { 
            alert(response.text);
        }, params);
    };

    function createDirectory(relativePath) {
        var postdata = { relativePath : relativePath };
        var params = {};
        params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.JSON;
        params[gadgets.io.RequestParameters.AUTHORIZATION] = gadgets.io.AuthorizationType.SIGNED;
        params[gadgets.io.RequestParameters.METHOD] = gadgets.io.MethodType.POST;
        params[gadgets.io.RequestParameters.POST_DATA] = gadgets.io.encodeValues(postdata);
        var url = apiEndPoint + "?action=createDirectory";
        gadgets.io.makeRequest(url, function(response) { 
            alert(response.text);
        }, params);
    };
</script>

<h3>Actions</h3>
<a href="javascript:pingServer()">pingServer</a> | 
<a href="javascript:serverInfo()">serverInfo</a> |
<a href="javascript:getMyGroups()">getMyGroups</a> (SURFconext) |
<a href="javascript:getMyFriends()">getMyFriends</a> (iGoogle) |
<a href="javascript:getDirList('/')">getDirList('/')</a> |
<a href="javascript:createDirectory('/test')">createDirectory('/test')</a>

]]>
  </Content>
</Module>
